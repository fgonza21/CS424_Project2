<!DOCTYPE html>
<meta charset="utf-8">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <meta charset="utf-8">

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style type="text/css">
    /* On mouse hover, lighten state color */
    path:hover {
        fill-opacity: .7;
    }

        /* Style for Custom Tooltip */
    div.tooltip {
        position: absolute;
        text-align: center;
        width: 60px;
        height: 28px;
        padding: 2px;
        font: 12px sans-serif;
        background: white;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
    }

    /* Legend Font Style */
    body {
        font: 11px sans-serif;
    }

    /* Legend Position Style */
    .legend {
        position:absolute;
        left:800px;
        top:350px;
    }



    //bootstrap stuff

    #topContainer {
      background-image: url("snow.jpg");
      height:400px;
      width:100%;
      background-size: cover;
    }

    #topRow {
      margin-top: 100px;
      text-align: center;
    }

    #topRow h1 {
      font-size: 300%;
    }

    .bold {
      font-weight: bold;
    }

    .marginTop {
      margin-top: 30px;
    }
    .center {
      text-align: center;
    }

    .white {
        color: #fff;
    }
    .title {
      margin-top: 100px;
      font-size: 300%;
    }
    .calendarIcon {
        margin-top: 14px;
    }
    .glyphicon {
        font-size: 20px;
    }

    #footer {
      background-color: #B0D1FB;
      width: 100%
    }

    .marginBottom {
      margin-bottom: 30px;

    }

    .appstoreImage  {
      width:250px;
    }
    div.tooltip {   
    position: absolute;         
    text-align: left;         
    width: 210px;                    
    height: 80px;                   
    padding: 12px;               
    font: 12px sans-serif;      
    background: rgba(0, 0, 0, 1); 
    color: #fff;
    border: 0px;        
    border-radius: 2px;         
    pointer-events: none;           
    }

    #graph {
    width: 1200px;
    height: 500px;
    }

    .tick line {
        stroke-dasharray: 2 2 ;
        stroke: #000000;
    }

    //vis5
    .node--library circle {
      fill: #FFF68F;
    }

    .node--school circle {
      fill: #D1EEEE;
    }

    .node--shooting circle {
      fill: #000000;
    }

    .node text {
      font: 10px sans serif;
    }

    .node--internal circle {
      fill: #555;
    }

    .node--internal text {
      text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;
    }

    .link {
      fill: none;
      stroke: #555;
      stroke-opacity: 0.4;
      stroke-width: 1.5px;
    }

    </style>
    </head>

<script src="http://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<body data-spy="scroll" data-target=".navbar-collapse">

<div class="navbar navbar-inverse navbar-fixed-top">
  
      <div class="container">
      
        <div class="navbar-header">
        
            <a href="" class="navbar-brand">Project</a>

            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            
          <span class="sr-only">Toggle navigation</span>

          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
            
            </button>
        
        </div>

        <div class="collapse navbar-collapse">

            <ul class="nav navbar-nav">
          
                <li><a href="#vis1">Vis 1</a></li>
                  
                <li><a href="#vis2">Vis 2</a></li>
                  
                <li><a href="#vis3">Vis 3</a></li>

                <li><a href="#vis4">Vis 4</a></li>

                <li><a href="#vis5">Vis 5</a></li>

            </ul>

            <form class="navbar-form navbar-right">
                <div class="form-group navbar-right">
                        <select class="form-control" data-show-icon="true" id="selectYear" >
                            <option value="2016">2016</option>
                            <option value="2015">2015</option>
                            <option value="2014">2014</option>
                            <option value="2013">2013</option>
                            <option value="2012">2012</option>
                            <option value="2011">2011</option>
                            <option value="2010">2010</option>
                            <option value="2009">2009</option>
                            <option value="2008">2008</option>
                            <option value="2007">2007</option>
                            <option value="2006">2006</option>
                            <option value="2005">2005</option>
                            <option value="2004">2004</option>
                            <option value="2003">2003</option>
                            <option value="2002">2002</option>
                            <option value="2001">2001</option>
                            <option value="0">-ALL-</option>
                        </select>
                </div>
            </form>

            <form class="navbar-form navbar-right white calendarIcon">
                <div><span class="glyphicon glyphicon-calendar navbar-right"></span></div>
            </form>


        </div>


      </div> 
  
</div> 



<div class="container marginTop" id="vis1"></div>
<div class="container" id="vis2"></div>
<div class="container" id="vis3"></div>
<div class="container" id="vis4"></div>
<div class="container" id="vis5"></div>

<script>

var crimes;
var newData;

var width = 1200,
        height = 800;

//vis1
var svg = d3.select("#vis1")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

//vis2
var svg2 = d3.select("#vis2")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

//vis3
var svg3 = d3.select("#vis3")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

//vis4
var svg4 = d3.select("#vis4")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

//vis5
var svg5 = d3.select("#vis5")
      .append("svg")
      .attr("width", width)
      .attr("height", 1060);


//Width and height
function createMap1() {
    var rateById = d3.map();

    var projection = d3.geoAlbers()
        .translate([width/2, height/2])
        .scale([99000])
        .rotate([87.6298,0])
        .center([0,41.8781]);

    //Define path generator
    var path = d3.geoPath()
      .projection(projection);

    var crimeData;
    var num;
    var nes;

    // Append Div for tooltip to SVG
    var div = d3.select("body")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

    d3.json("community.json", function (data) {
        var values;
        var chicagodata;
        d3.csv("SchoolLocations.csv", function (schoolData) {
        d3.csv("LibraryLocations.csv", function (libraryData) {
        d3.json("chicago.json", function (chicago) {
            chicagodata = chicago;
        d3.csv("data/crimes.csv", function (csvdata) {
            var e = document.getElementById("selectYear");
            var usrYear = e.options[e.selectedIndex].value;
            if (usrYear == 0) {
                crimeData = csvdata;
            } else {
                crimeData = csvdata.filter(function(a) { 
                    return a.Year == usrYear;
                });
            }
            nes = d3.nest().key(function(d) { return d["Year"]; }).key(function(d) { return d["Community Area"]; }).entries(csvdata);
            //nes[0] year
            //nes[0].values areas
            //nes[0].values[0].values array of crimes

            // Loop through each community
            for (var i = 0; i < data.length; i++) {

                // Grab Community Name
                var dataCom = data[i].Name;

                // Grab data value
                var dataValue = data[i].Total;

                // Find the corresponding community
                for (var j = 0; j < data.features.length; j++) {
                    var jsonState = data.features[j].properties.name;

                    if (dataCom == jsonState) {
                        // Copy the data value into the JSON
                        data.features[j].properties.total = dataValue;

                        break;
                    }
                }
            }


            // Bind the data to the SVG and create one path per GeoJSON feature
            svg.selectAll("path")
                .data(data.features)
                .enter()
                .append("path")
                .attr("d", path)
                .attr("lib", function (d) {
                    for (var k=0; k<chicagodata.length; k++) {
                        //console.log(chicagodata[k].id);
                        //return chicagodata.id;
                        if (chicagodata[k].idNum == d.id && chicagodata[k].id.substring(chicagodata[k].id.lastIndexOf(".") + 1) == "Libraries") {
                            return chicagodata[k].value;
                        }
                    }
                    return 0;
                })
                .attr("schools", function (d) {
                    for (var k=0; k<chicagodata.length; k++) {
                        //console.log(chicagodata[k].id);
                        //return chicagodata.id;
                        if (chicagodata[k].idNum == d.id && chicagodata[k].id.substring(chicagodata[k].id.lastIndexOf(".") + 1) == "Schools") {
                            return chicagodata[k].value;
                        }
                    }
                    return 0;
                })

                .style("stroke", "#fff")
                .style("stroke-width", "1")
                .style("fill", function (d) {

                    // Can set fill in color here
                    var value = d.properties.visited;

                    if (value) {
                        //If value exists…
                        return color(value);
                    }
                    else {
                        //If value is undefined…
                        return "rgb(128,128,128)";
                    }
                })    //<span style='color:red'>" + d.frequency + "</span>"
                .on("mouseover", function (d) {
                    var e = document.getElementById("selectYear");
                    var usrYear = e.options[e.selectedIndex].value;
                    var count=0;
                    if (usrYear == 0) {
                        var temp = csvdata.filter(function(a) {
                            return a['Community Area'] == parseInt(d.id);
                        })
                        count = temp.length; 
                    } else {
                        for (var i=0; i<nes.length; i++) {
                            if (nes[i].key == usrYear) {
                                for (var j=0; j<nes[i].values.length; j++) {
                                    if (nes[i].values[j].key == parseInt(d.id)) {
                                        count = nes[i].values[j].values.length;
                                    }
                                }
                            }
                        } 
                    }
                    d3.select(this)
                    .style("fill", "#B0171F");
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    div.html("Community: " + d.properties.name + ", " + "</br>" + 
                        "Shootings: <span style='color:red'><strong>" + count + "</strong></span>" + "</br>" + "# of Libraries: " + d3.select(this).attr("lib")
                        + "</br>" + "# of Schools: " + d3.select(this).attr("schools"))
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })

                // fade out tooltip on mouse out
                .on("mouseout", function(data) {
                    d3.select(this)
                    .style("fill", "rgb(128,128,128)");
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                });



                // Plot the Libraries
                svg.selectAll("circle")
                    .data(libraryData)
                    .enter()
                    .append("circle")
                    .attr("cx", function (d) {
                        return projection([d.Longitude, d.Latitude])[0];
                    })
                    .attr("cy", function (d) {
                        return projection([d.Longitude, d.Latitude])[1];
                    })
                    .attr("r", 3)
                    .style("fill", "rgb(0,255,0)")
                    .style("opacity", 0.50);

                // Plot the Schools
                svg.selectAll("circle")
                    .data(schoolData)
                    .enter()
                    .append("circle")
                    .attr("cx", function (d) {
                        return projection([d.Longitude, d.Latitude])[0];
                    })
                    .attr("cy", function (d) {
                        return projection([d.Longitude, d.Latitude])[1];
                    })
                    .attr("r", 3)
                    .style("fill", "rgb(255,255,0)")
                    .style("opacity", 0.50);

                svg.selectAll("circle")
                    .data(crimeData)
                    .enter()
                    .append("circle")
                    .attr("cx", function (d) {
                        return projection([d.Longitude, d.Latitude])[0];
                    })
                    .attr("cy", function (d) {
                        return projection([d.Longitude, d.Latitude])[1];
                    })
                    .attr("r", 1)
                    .style("fill", "rgb(0,0,0)")
                    .style("opacity", 0.85)
            }); 
            });
            });
            });
    });
}

function choroplethMap() {
    var rateById = d3.map();
    var projection = d3.geoAlbers()
        .translate([width/2, height/2])
        .scale([99000])
        .rotate([87.6298,0])
        .center([0,41.8781]);

    var e = document.getElementById("selectYear");
    var usrYear = e.options[e.selectedIndex].value;

    if (usrYear == 0) {
        var color = d3.scaleQuantize()
            .domain([0,100])
            .range(["#ffb2b2","#ff9999","#ff7f7f","#ff6666","#ff4c4c","#ff3232","ff1919","ff0000","#e50000"]);
    } else {
        var color = d3.scaleQuantize()
            .domain([0,240])
            .range(["#ffb2b2","#ff9999","#ff7f7f","#ff6666","#ff4c4c","#ff3232","ff1919","ff0000","#e50000"]);
    }
    //Define path generator
    var path = d3.geoPath()
      .projection(projection);

    var crimeData;
    var num;
    var nes;

    // Append Div for tooltip to SVG
    var div = d3.select("body")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

    d3.json("community.json", function (data) {
        var values;
        var chicagodata;
        d3.json("chicago.json", function (chicago) {
            chicagodata = chicago;
        d3.csv("data/crimes.csv", function (csvdata) {
            if (usrYear == 0) {
                crimeData = csvdata;
            } else {
                crimeData = csvdata.filter(function(a) { 
                    return a.Year == usrYear;
                });
            }
            nes = d3.nest().key(function(d) { return d["Year"]; }).key(function(d) { return d["Community Area"]; }).entries(csvdata);
            //nes[0] year
            //nes[0].values areas
            //nes[0].values[0].values array of crimes

            // Loop through each community
            for (var i = 0; i < data.length; i++) {

                // Grab Community Name
                var dataCom = data[i].Name;

                // Grab data value
                var dataValue = data[i].Total;

                // Find the corresponding community
                for (var j = 0; j < data.features.length; j++) {
                    var jsonState = data.features[j].properties.name;

                    if (dataCom == jsonState) {
                        // Copy the data value into the JSON
                        data.features[j].properties.total = dataValue;

                        break;
                    }
                }
            }

            // Bind the data to the SVG and create one path per GeoJSON feature
            svg2.selectAll("path")
                .data(data.features)
                .enter()
                .append("path")
                .attr("d", path)
                .attr("lib", function (d) {
                    for (var k=0; k<chicagodata.length; k++) {
                        if (chicagodata[k].idNum == d.id && chicagodata[k].id.substring(chicagodata[k].id.lastIndexOf(".") + 1) == "Libraries") {
                            return chicagodata[k].value;
                        }
                    }
                    return 0;
                })
                .attr("schools", function (d) {
                    for (var k=0; k<chicagodata.length; k++) {
                        //console.log(chicagodata[k].id);
                        //return chicagodata.id;
                        if (chicagodata[k].idNum == d.id && chicagodata[k].id.substring(chicagodata[k].id.lastIndexOf(".") + 1) == "Schools") {
                            return chicagodata[k].value;
                        }
                    }
                    return 0;
                })
                .style("stroke", "#fff")
                .style("stroke-width", "1")
                .style("fill", function (d) {
                    var e = document.getElementById("selectYear");
                    var usrYear = e.options[e.selectedIndex].value;
                    var count=0;
                    if (usrYear != 0) {
                        for (var i=0; i<nes.length; i++) {
                            if (nes[i].key == usrYear) {
                                for (var j=0; j<nes[i].values.length; j++) {
                                    if (nes[i].values[j].key == parseInt(d.id)) {
                                        count = nes[i].values[j].values.length;
                                        return color(parseInt(count));
                                    }
                                }
                            }
                        }
                    } else {
                        for (var i=0; i<nes.length; i++) {
                            for (var j=0; j<nes[i].values.length; j++) {
                                if (nes[i].values[j].key == parseInt(d.id)) {
                                    count = nes[i].values[j].values.length;
                                    return color(parseInt(count));
                                }
                            }
                        }
                    }
                    return "#ffe5e5";
                })
                .on("mouseover", function (d) {
                    var e = document.getElementById("selectYear");
                    var usrYear = e.options[e.selectedIndex].value;
                    var count=0;
                    if (usrYear == 0) {
                        /*var temp = csvdata.filter(function(a) {
                            return a['Community Area'] == parseInt(d.id);
                        })
                        count = temp.length;*/ 
                        for (var i=0; i<nes.length; i++) {
                            for (var j=0; j<nes[i].values.length; j++) {
                                if (nes[i].values[j].key == parseInt(d.id)) {
                                    count += nes[i].values[j].values.length;
                                }
                            }
                        } 
                    } else {
                        for (var i=0; i<nes.length; i++) {
                            if (nes[i].key == usrYear) {
                                for (var j=0; j<nes[i].values.length; j++) {
                                    if (nes[i].values[j].key == parseInt(d.id)) {
                                        count = nes[i].values[j].values.length;
                                    }
                                }
                            }
                        } 
                    }
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    div.html("Community: " + d.properties.name + ", " + "</br>" + 
                        "Shootings: <span style='color:red'><strong>" + count + "</strong></span>"
                        + "</br>" + "# of Libraries: " + d3.select(this).attr("lib")
                        + "</br>" + "# of Schools: " + d3.select(this).attr("schools"))
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })

                // fade out tooltip on mouse out
                .on("mouseout", function(data) {
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
        }); 
    });
    });
}

function createMap3 () {
    //Width and height

var rateById = d3.map();

var projection = d3.geoAlbers()
    .translate([width/2, height/2])
    .scale([99000])
    .rotate([87.6298,0])
    .center([0,41.8781]);


var e = document.getElementById("selectYear");
var usrYear = e.options[e.selectedIndex].value;

if (usrYear == 0) { //2001-2016
    var color = d3.scaleQuantize()
        .domain([0, 1000])
        .range(['#053061', '#2166ac', '#67a9cf', '#d1e5f0', '#f4a582', '#d6604d','#b2182b', '#67001f']);
} else { //individual year
    var color = d3.scaleQuantize()
        .domain([0, 100])
        .range(['#053061', '#2166ac', '#67a9cf', '#d1e5f0', '#f4a582', '#d6604d','#b2182b', '#67001f']);
}


//Define path generator
var path = d3.geoPath()
  .projection(projection);

//Create SVG element
/*var svg = d3.select("body")
  .append("svg")
  .attr("width", width)
  .attr("height", height);*/

// Append Div for tooltip to SVG
var div = d3.select("body")
    .append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

// Load in Shooting data
d3.csv("ShootingTotals.csv", function(data) {
// Load GeoJSON data
    d3.json("community.json", function (json) {

        // Loop through each community
        for (var i = 0; i < data.length; i++) {

            // Grab Community Name
            var dataCom = data[i].Name;

            // Grab data value
            var dataValue = data[i].Total;

            // Find the corresponding community
            for (var j = 0; j < json.features.length; j++) {
                var jsonState = json.features[j].properties.name;

                if (dataCom == jsonState) {
                    // Copy the data value into the JSON
                    json.features[j].properties.total = dataValue;  // Copies Total
                    break;
                }
            }
        }
        var nes;
        //var usrYear = 2004;
        d3.csv("data/crimes.csv", function (csvdata) {
            if (usrYear == 0) {
                crimeData = csvdata;
            } else {
                crimeData = csvdata.filter(function(a) { 
                    return a.Year == usrYear;
                });
            }
            nes = d3.nest().key(function(d) { return d["Year"]; }).key(function(d) { return d["Community Area"]; }).entries(csvdata);
        

        // Bind the data to the SVG and create one path per GeoJSON feature
        svg3.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("stroke", "#000")
            .style("stroke-width", "1")
            .style("fill", function (d) {

                // Can set fill in color here
                /*var value = d.properties.total;

                if (value) {
                    //If value exists…
                    console.log("COLOR: " + color(value) + ", " + value );
                    return color(value);
                }
                else {
                    //If value is undefined…
                    return "rgb(255,0,0)";
                }*/

                    var count=0;
                    if (usrYear != 0) {
                        for (var i=0; i<nes.length; i++) {
                            if (nes[i].key == usrYear) {
                                for (var j=0; j<nes[i].values.length; j++) {
                                    if (nes[i].values[j].key == parseInt(d.id)) {
                                        count = nes[i].values[j].values.length;
                                        return color(parseInt(count));
                                    }
                                }
                            }
                        }
                    } else {
                        for (var i=0; i<nes.length; i++) {
                            for (var j=0; j<nes[i].values.length; j++) {
                                if (nes[i].values[j].key == parseInt(d.id)) {
                                    count = nes[i].values[j].values.length;
                                    return color(parseInt(count));
                                }
                            }
                        }
                    }
            })

            .on("mouseover", function(data) {
                div.transition()
                    .duration(200)
                    .style("opacity", .9);
                div.text(data.properties.total)
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px");
            })

            // fade out tooltip on mouse out
            .on("mouseout", function(data) {
                div.transition()
                    .duration(500)
                    .style("opacity", 0);
            });
        });
    });
});
}

function createMap4() {
        //var width,height
    var chartWidth, chartHeight
    var margin
    //var svg4 = d3.select("#graph").append("svg")
    var axisLayer = svg4.append("g").classed("axisLayer", true)
    var chartLayer = svg4.append("g").classed("chartLayer", true)
        
    var xScale = d3.scaleBand()
    var xInScale = d3.scaleBand();
    var yScale = d3.scaleLinear()
    
    var color = d3.scaleOrdinal()
        .range(["Black", "Blue", "Red"]);
    
    d3.csv("counts.csv", cast,  main)
    
    function cast(d) {
        Object.keys(d).forEach(function(key){
            if (!isNaN(+d[key])) d[key] = +d[key]
        })
        return d 
    }
    
    function main(data) {
        //console.log(data)
                
        var nested = d3.nest()
            .rollup(function(d){ delete d[0].CommunityAreaName; return d[0] })
            .key(function(d){ return d.CommunityAreaName })
            .entries(data)

        nested.forEach(function(d){
            d.age = Object.keys(d.value).map(function(key){
                return {key:key, value:d.value[key]}
            })
        })

        setSize(nested)
        drawAxis()
        drawChart(nested)    
    }
    
    function setSize(nested) {
        //width = document.querySelector("#graph").clientWidth
        //height = document.querySelector("#graph").clientHeight
    
        margin = {top:0, left:100, bottom:140, right:0 }
                
        chartWidth = width - (margin.left+margin.right)
        chartHeight = height - (margin.top+margin.bottom)
        
        svg4.attr("width", width).attr("height", height)
        
        axisLayer.attr("width", width).attr("height", height)
        
        chartLayer
            .attr("width", chartWidth)
            .attr("height", chartHeight)
            .attr("transform", "translate("+[margin.left, margin.top]+")")  
                
        xScale.domain(nested.map(function(d) { return d.key }))
            .range([0, chartWidth]).paddingInner(0.1)
                    
        var ageNames = Object.keys(nested[0].value)
        
        xInScale.domain(ageNames).range([0, xScale.bandwidth()])
        
        var yMax = d3.max(nested.map(function(d){
            var values = Object.keys(d.value).map(function(key){
                return d.value[key]
            })
            return d3.max(values)
        }))

        yScale.domain([0, yMax]).range([chartHeight, 0])   
    }
    
    function drawChart(nested) {
        var t = d3.transition()
            .duration(1000)
            .ease(d3.easeLinear)
        
        var contry = chartLayer.selectAll(".contry")
            .data(nested)
            
        var newCountry = contry.enter().append("g")
            .attr("class", "contry")
                            
        contry.merge(newCountry)
            .attr("transform", function(d) { return "translate(" + [xScale(d.key), 0] + ")"; });
            
        var bar = newCountry.selectAll(".bar")
            .data(function(d){ return d.age })

        var newBar = bar.enter().append("rect").attr("class", "bar")
                        
        bar.merge(newBar)
            .attr("width", xInScale.bandwidth())
            .attr("height", 0)
            .attr("fill", function(d) { return color(d.key); })
            .attr("transform", function(d) { return "translate(" + [xInScale(d.key), chartHeight] + ")" })
            
       bar.merge(newBar).transition(t)
            .attr("height", function(d) { return chartHeight - yScale(d.value); })
            .attr("transform", function(d) { return "translate(" + [xInScale(d.key), yScale(d.value)] + ")" })        
    }
    
    function drawAxis(){
        var yAxis = d3.axisLeft(yScale)
            .tickSizeInner(-chartWidth)
        
        axisLayer.append("g")
            .attr("transform", "translate("+[margin.left, margin.top]+")")
            .attr("class", "axis y")
            .call(yAxis);
            
        var xAxis = d3.axisBottom(xScale)
    
        axisLayer.append("g")
            .attr("class", "axis x")
            .attr("transform", "translate("+[margin.left, chartHeight]+")")
            .call(xAxis)
            .selectAll("text")  
              .style("text-anchor", "end")
              .attr("font-family", "sans-serif")
              .attr("font-size", "12px")
              .attr("dx", "-.8em")
              .attr("dy", ".15em")
              .attr("transform", "rotate(-65)" );
    }    
}

function createMap5() {

    //var svg = d3.select("svg"),
    //width = +svg5.attr("width"),
    //height = +svg5.attr("height"),
    //height = 1060;
    g = svg5.append("g").attr("transform", "translate(" + (width / 2 + 40) + "," + (height / 2 + 90) + ")");

var stratify = d3.stratify()
    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(".")); });

var tree = d3.tree()
    .size([360, 320])
    .separation(function(a, b) { return (a.parent == b.parent ? 1 : 2) / a.depth; });

    d3.json("chicago.json", function(error, data) {
      if (error) throw error;

      var root = tree(stratify(data));

      var link = g.selectAll(".link")
        .data(root.descendants().slice(1))
        .enter().append("path")
          .attr("class", "link")
          .attr("d", function(d) {
            return "M" + project(d.x, d.y)
                + "C" + project(d.x, (d.y + d.parent.y) / 2)
                + " " + project(d.parent.x, (d.y + d.parent.y) / 2)
                + " " + project(d.parent.x, d.parent.y);
          });

      var node = g.selectAll(".node")
        .data(root.descendants())
        .enter().append("g")
        .attr("class", function(d) { return "node" + (d.children ? " node--internal" : " node--leaf"); })
        .attr("transform", function(d) { return "translate(" + project(d.x, d.y) + ")"; });

      node.append("circle")
          .attr("r", 2.5);

        node.append("text")
          .attr("dy", ".16em")
          .attr("x", function(d) { return d.x < 180 === !d.children ? 6 : -6; })
          .style("text-anchor", function(d) { return d.x < 180 === !d.children ? "start" : "end"; })
          .attr("transform", function(d) { return "rotate(" + (d.x < 180 ? d.x - 90 : d.x + 90) + ")"; })
          .text(function(d) { return d.id.substring(d.id.lastIndexOf(".") + 1); });
    });

    function project(x, y) {
      var angle = (x - 90) / 180 * Math.PI, radius = y;
      return [radius * Math.cos(angle), radius * Math.sin(angle)];
    }
}


function change() {
    //
    d3.selectAll("circle").remove();

    svg2.selectAll("path").remove();

    svg3.selectAll("path").remove();
    
    createMap1();
    choroplethMap();
    createMap3();
}

//runs change function on year select
d3.selectAll("select").on("change", change);

createMap1();
choroplethMap();
createMap3();
createMap4();
createMap5();

</script>



</body>